(n=>{n.widget("evergreen.q4Pdfviewer",{options:{url:"",relativeLevel:"../../",useJSONP:!1,tags:[],aspectRatio:[4,3],languageId:null,pdfviewerContainer:".evergreen-pdfviewer-ratio",dateFormat:"MMMM D, YYYY",timeFormat:"h:mm A",tpl:"",loadingClass:"",loadingMessage:"",itemNotFoundMessage:"",complete:function(){}},_create:function(){var e=this;e.element.addClass(e.options.loadingClass).html(e.options.loadingMessage),e._getPresentation()},_usePublic:function(){return"function"!=typeof GetViewType||"0"!=GetViewType()},_renderWidget:function(e){var t=this;t.element.html(Mustache.render(t.options.tpl,e)).removeClass(t.options.loadingClass).find(t.options.pdfviewerContainer).css({"padding-bottom":t.options.aspectRatio[1]/t.options.aspectRatio[0]*100+"%",position:"relative"}),this.element.find("iframe").attr("title")||this.element.find("iframe").attr("title",e.title)},_getPresentation:function(){var t=this,e=(this.options,t._usePublic()?"/feed/Presentation.svc/GetPresentationList":"/services/PresentationService.svc/GetPresentationList");t._getData(e,t._buildParams()).done(function(e){e.GetPresentationListResult.length?t._mapData(e.GetPresentationListResult[0]):t.element.html(t.options.itemNotFoundMessage).removeClass(t.options.loadingClass)})},_getData:function(e,t){var i=this.options;return this._usePublic()?n.ajax({type:"GET",url:i.url+e,data:t,contentType:i.url?"text/plain":"application/json; charset=utf-8",dataType:i.useJSONP?"jsonp":"json"}):n.ajax({type:"POST",url:e,data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json"})},_buildParams:function(){var e=this,t=this.options;return e._usePublic()?{presentationDateFilter:3,excludeSelection:1,tagList:(e.options.tags||[]).join("|"),LanguageId:t.languageId||("function"==typeof GetLanguageId?GetLanguageId():1)}:{serviceDto:{ViewType:GetViewType(),ViewDate:GetViewDate(),RevisionNumber:GetRevisionNumber(),LanguageId:t.languageId||("function"==typeof GetLanguageId?GetLanguageId():1),Signature:GetSignature(),StartIndex:0,ItemCount:1,IncludeTags:!0,TagList:e.options.tags},presentationSelection:3,excludeSelection:1}},_mapData:function(e){var t=this,i=new Date(e.PresentationDate),i={title:e.Title,date:moment(i).format(t.options.dateFormat),time:moment(i).format(t.options.timeFormat),body:e.Body,tags:e.TagList,url:e.DocumentPath,detailsUrl:e.LinkToDetailPage,relativeUrl:t.options.relativeLevel+e.DocumentPath.split("/files/").pop(),thumb:e.ThumbnailPath,size:e.DocumentFileSize,type:e.DocumentFileType,urlFileType:q4EvergreenHelpers.getUrlFileType(e.DocumentPath)};t._renderWidget(i),t._trigger("complete")},destroy:function(){this.element.html("")},_setOption:function(e,t){this._superApply(arguments)}})})($tudio);