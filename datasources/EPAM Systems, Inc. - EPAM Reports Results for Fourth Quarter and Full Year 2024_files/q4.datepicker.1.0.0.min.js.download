(d=>{d.widget("q4.q4datepicker",{options:{datepickerOpts:{dateFormat:"yy/mm/dd"},showTodayButton:!0,accessibleButton:!0,dateRange:!1,beforeDateSelect:null},datepickerContainer:null,keys:{arrowLeft:37,arrowRight:39,arrowUp:38,arrowDown:40,tab:9,enter:13,space:32,pageUp:33,pageDown:34,home:36,end:35,escape:27},selectors:{select:"ui-datepicker-select",close:"ui-datepicker-close",today:"ui-datepicker-current",prev:"ui-datepicker-prev",next:"ui-datepicker-next",day:"ui-state-default",month:"ui-datepicker-month",year:"ui-datepicker-year",highlightedDay:"ui-state-highlight",activeDay:"ui-state-active",container:"ui-datepicker-div",title:"ui-datepicker-title"},btnAttrs:{href:"javascript:void(0)",role:"button"},contAttrs:{"aria-label":"Calendar view date-picker",role:"dialog"},cssFlag:!1,_init:function(){var s=this,a=this.options;s.rangeOne="",s.rangeTwo="",s.datepickerOpts=d.extend({},{beforeShowDay:a.dateRange?function(e){return s.beforeShowFunc(e)}:null,onSelect:a.dateRange?function(e,t){s.setRange(e,t),a.beforeDateSelect&&a.beforeDateSelect(e,t,s)}:null,showOn:a.accessibleButton?"button":"focus",buttonText:'<span class="q4-icon_calendar"><span class="sr-only">Calendar button</span></span>',showButtonPanel:!0,closeText:"Close",range:a.dateRange,rangeDates:{rangeOne:"",rangeTwo:""},showToday:a.showTodayButton},a.datepickerOpts),s._callDatepicker()},beforeShowFunc:function(e){var t=this,s=new Date(t.rangeOne),a=new Date(t.rangeTwo);return[!0,s&&(e.getTime()==s.getTime()||a&&s<=e&&e<=a||a&&e<=s&&a<=e)?t.selectors.activeDay:""]},setRange:function(e,t){var s=this;!s.rangeOne||s.rangeTwo?(s.rangeOne=e,t.settings.rangeDates.rangeOne=e,s.rangeTwo="",t.settings.rangeDates.rangeTwo=""):(s.rangeTwo=e,t.settings.rangeDates.rangeTwo=e)},addAttrs:function(e,t){var s,a=d("."+e);for(s in t)a.attr(s,t[s])},setFocus:function(e){d("."+e).focus()},closeCalendar:function(e){d(e.input).datepicker("hide").focus()},selectRange:function(e){var t,s=(e=e).settings.rangeDates.rangeOne,a=(a=e.settings.rangeDates.rangeTwo)||s,a=new Date(s)<new Date(a)?(t=s,a):(t=a,s);d(e.input).attr("data-range-begin",t),d(e.input).attr("data-range-end",a),s&&(d(e.input).val(t+" - "+a),d(e.input).datepicker("hide")),d(e.input).trigger("change"),d(e.input).focus()},appendSelect:function(e){var t=this;0===d("button."+t.selectors.select).length&&d("<button type='button' class='"+t.selectors.select+" ui-state-default ui-priority-primary ui-corner-all'>Select</button>").insertAfter(d("button."+t.selectors.close)),d("button."+t.selectors.select).on("click",function(){t.selectRange(e)})},handleNextPrevClicks:function(e){var t=e.data.widg,s=e.data.instance,a=e.data.dest;setTimeout(function(){t.updateElements(s),t.prepHighlightState(),t.setFocus(a)},0)},previousDay:function(e){var t,s,a=this;e&&(t=d(e).closest("td"))&&(t=d(t).prev(),s=d("a."+a.selectors.day,t)[0],t&&s?a.setHighlightState(s,a.datepickerContainer):a.previousWeek(e))},previousWeek:function(e){var t,s=this;e&&(e=d(e).closest("tr"))&&((e=d(e).prev())&&0!==e.length?(e=d("td a."+s.selectors.day,e),(t=e[e.length-1])&&setTimeout(function(){s.setHighlightState(t,s.datepickerContainer)},0)):s.previousMonth())},previousMonth:function(){var t=this;d("."+t.selectors.prev)[0].click(),setTimeout(function(){var e=d("tr",t.datepickerContainer),e=d("td a."+t.selectors.day,e[e.length-1]),e=e[e.length-1];t.setHighlightState(e,t.datepickerContainer)},0)},nextDay:function(e){var t,s,a=this;e&&(t=d(e).closest("td"))&&(t=d(t).next(),s=d("a."+a.selectors.day,t)[0],t&&s?a.setHighlightState(s,a.datepickerContainer):a.nextWeek(e))},nextWeek:function(e){e&&(e=d(e).closest("tr"),(e=d(e).next())&&0!==e.length?(e=d("a."+this.selectors.day,e)[0])&&this.setHighlightState(e,this.datepickerContainer):this.nextMonth())},nextMonth:function(){var t=this;d("."+t.selectors.next)[0].click(),setTimeout(function(){var e=d("a."+t.selectors.day,t.datepickerContainer)[0];t.setHighlightState(e,t.datepickerContainer)},0)},upHandler:function(n,i){var o,e,t,c=this,s=d(n).closest("tr"),a=d("."+c.selectors.prev)[0];s&&(o=d("td",s),e=d("a."+c.selectors.day,s),e=d.inArray(n,e),s=d(s).prev(),e=d("td",s)[e],t=d("a."+c.selectors.day,e)[0],s&&e&&t?c.setHighlightState(t,i):(a.click(),setTimeout(function(){var e=d("tr",i),t=e[e.length-1],s=d("td",t),a=d.inArray(n.parentNode,o),s=s[a],r=d("a."+c.selectors.day,s)[0];t&&s&&r?c.setHighlightState(r,i):(t=e[e.length-2],s=d("td",t)[a],(r=d("a."+c.selectors.day,s)[0])&&c.setHighlightState(r,i))},0)))},downHandler:function(e,a){var r,t,n=this,s=d(e).closest("tr"),i=d("."+n.selectors.next)[0];s&&(t=d("td",s),r=d.inArray(e.parentNode,t),e=d(s).next(),t=d("td",e)[r],s=d("a."+n.selectors.day,t)[0],e&&t&&s?n.setHighlightState(s,a):(i.click(),setTimeout(function(){var e=d("tbody tr",a),t=d("td",e[0])[r],s=d("a."+n.selectors.day,t)[0];t&&s?n.setHighlightState(s,a):(t=e[1],s=d("td",t)[r],e=d("a."+n.selectors.day,s)[0],t&&e&&n.setHighlightState(e,a))},0)))},updateElements:function(e){var t=this,s=e.settings.range,a=e.settings.showToday;t.datepickerContainer&&(a&&d("."+t.selectors.today).show(),t.addAttrs(t.selectors.next,t.btnAttrs),t.addAttrs(t.selectors.prev,t.btnAttrs),t.appendScreenReaderMonthText(t.selectors.next),t.appendScreenReaderMonthText(t.selectors.prev),t.appendScreenReaderDayName(),t.datepickerContainer.addClass(t.selectors.container),t.addAttrs(t.selectors.container,t.contAttrs),d("."+t.selectors.next).on("click",{widg:t,instance:e,dest:t.selectors.next},t.handleNextPrevClicks),d("."+t.selectors.prev).on("click",{widg:t,instance:e,dest:t.selectors.prev},t.handleNextPrevClicks),t.monthDayYearText(),s)&&t.appendSelect(e)},prepHighlightState:function(){var e=this,t=d("."+e.selectors.highlightedDay,e.datepickerContainer)[0]||d("."+e.selectors.day,e.datepickerContainer)[0];t&&e.datepickerContainer&&e.setHighlightState(t,e.datepickerContainer)},setHighlightState:function(e,t){t=d("."+this.selectors.highlightedDay,t)[0];d(t).removeClass(this.selectors.highlightedDay),d(e).addClass(this.selectors.highlightedDay).focus()},monthDayYearText:function(){var n=this,e=d("a."+n.selectors.day,n.datepickerContainer);d(e).attr("role","button"),d(e).each(function(e,t){var s=d(t).closest("tr"),s=d("td",s),s=d.inArray(t.parentNode,s),s=d("thead tr th",n.datepickerContainer)[s],s=d("span",s)[0],a=d("."+n.selectors.title+" ."+n.selectors.month),a=(a.is("select")?a.find("option:selected"):a).text(),r=d("."+n.selectors.title+" ."+n.selectors.year),r=(r.is("select")?r.find("option:selected"):r).text();number=t.innerHTML,s&&a&&number&&r&&(s=s.title+", "+a+" "+t.innerHTML+", "+r,t.setAttribute("aria-label",s))})},appendScreenReaderMonthText:function(e){var t=this,e=d("."+e),s=e.hasClass(t.selectors.next),a=["January","February","March","April","May","June","July","August","September","October","November","December"],r=d("."+t.selectors.title+" ."+t.selectors.month),r=(r.is("select")?r.find("option:selected"):r).text(),n=d.inArray(r,a),t=d("."+t.selectors.title+" ."+t.selectors.year),t=(t.is("select")?t.find("option:selected"):t).text(),n=s?n+1:n-1;s&&r===a[11]?(t=parseInt(t,10)+1,n=0):s||r!==a[0]||(t=parseInt(t,10)-1,n=a.length-1),r=s?'<p class="sr-only">Next Month, '+a[n]+" "+t+"</p>":'<p class="sr-only">Previous Month, '+a[n]+" "+t+"</p>",e.find(".ui-icon").html(r)},appendScreenReaderDayName:function(){d(".ui-datepicker-calendar thead tr th").each(function(e,t){var t=d(t),s=t.find("span").attr("aria-hidden","true").attr("title");t.append('<span class="sr-only">'+s+"</span>")})},datePickHandler:function(e){if(d.datepicker._datepickerShowing){var t,s=e.data.widg,a=e.data.instance,r=a.settings.range,n=a.settings.showToday,i=e.which,o=e.shiftKey&&e.which===s.keys.tab,c=e.target;if(d("."+s.selectors.highlightedDay,s.datepickerContainer)[0]||(t=d("a."+s.selectors.activeDay)[0],s.setHighlightState(t,s.datepickerContainer)),i!==s.keys.tab)switch(i){case s.keys.escape:e.stopPropagation(),s.closeCalendar(a);break;case s.keys.arrowLeft:!d(c).hasClass(s.selectors.close)&&d(c).hasClass(s.selectors.day)&&(e.preventDefault(),s.previousDay(c));break;case s.keys.arrowRight:!d(c).hasClass(s.selectors.close)&&d(c).hasClass(s.selectors.day)&&(e.preventDefault(),s.nextDay(c));break;case s.keys.arrowUp:!d(c).hasClass(s.selectors.close)&&d(c).hasClass(s.selectors.day)&&(e.preventDefault(),s.upHandler(c,s.datepickerContainer));break;case s.keys.arrowDown:!d(c).hasClass(s.selectors.close)&&d(c).hasClass(s.selectors.day)&&(e.preventDefault(),s.downHandler(c,s.datepickerContainer));break;case s.keys.enter:d(c).hasClass(s.selectors.close)?(e.preventDefault(),s.closeCalendar(a)):d(c).hasClass(s.selectors.day)?r||setTimeout(function(){s.closeCalendar(a)},100):d(c).hasClass(s.selectors.select)?s.selectRange(a):d(c).hasClass(s.selectors.today)?(e.preventDefault(),s.setFocus(s.selectors.highlightedDay),s.selectRange(a)):(d(c).hasClass(s.selectors.prev)||d(c).hasClass(s.selectors.prev))&&s.handleNextPrevClicks({data:{widg:s,instance:a,dest:s.selectors.prev}});break;case s.keys.space:return d(c).hasClass(s.selectors.prev)||d(c).hasClass(s.selectors.next)?(e.preventDefault(),c.click()):(d(c).hasClass(s.selectors.month)||d(c).hasClass(s.selectors.year))&&e.preventDefault(),!1;case s.keys.pageUp:case s.keys.pageDown:e.preventDefault();break;case s.keys.home:e.preventDefault();var l=d(c).closest("tbody").find("."+s.selectors.day)[0];l&&s.setHighlightState(l,d(s.datepickerContainer)[0]);break;case s.keys.end:e.preventDefault();l=d(c).closest("tbody").find("."+s.selectors.day),l=l[l.length-1];l&&s.setHighlightState(l,d(s.datepickerContainer)[0])}else e.preventDefault(),d(c).hasClass(s.selectors.close)?o?r?s.setFocus(s.selectors.select):n?s.setFocus(s.selectors.today):s.setFocus(s.selectors.highlightedDay):s.setFocus(s.selectors.prev):d(c).hasClass(s.selectors.today)?o?s.setFocus(s.selectors.highlightedDay):r?s.setFocus(s.selectors.select):s.setFocus(s.selectors.close):d(c).hasClass(s.selectors.select)?o?n?s.setFocus(s.selectors.today):s.setFocus(s.selectors.highlightedDay):s.setFocus(s.selectors.close):d(c).hasClass(s.selectors.prev)?o?s.setFocus(s.selectors.close):s.setFocus(s.selectors.next):d(c).hasClass(s.selectors.next)?o?s.setFocus(s.selectors.prev):s.setFocus(s.selectors.highlightedDay):d(c).hasClass(s.selectors.day)&&(o?s.setFocus(s.selectors.next):n?s.setFocus(s.selectors.today):r?s.setFocus(s.selectors.select):s.setFocus(s.selectors.close))}},datepicker_extendRemove:function(e,t){for(var s in d.extend(e,t),t)null==t[s]&&(e[s]=t[s]);return e},datepicker_getZindex:function(e){for(var t;e.length&&e[0]!==document;){if(("absolute"===(t=e.css("position"))||"relative"===t||"fixed"===t)&&(t=parseInt(e.css("zIndex"),10),!isNaN(t))&&0!==t)return t;e=e.parent()}return 0},_callDatepicker:function(){var o=this;o.q4datepicker=o.element.datepicker(o.datepickerOpts),o.datepickerContainer=d("#"+o.selectors.container),d(o.q4datepicker).off("focus").on("click",function(){o.q4datepicker.datepicker("show")}).on("keydown",function(e){13==e.keyCode&&(e.preventDefault(),o.q4datepicker.datepicker("show"))}),d.datepicker._showDatepicker=function(t){var e,s,a,r,n,i;"input"!==(t=t.target||t).nodeName.toLowerCase()&&(t=d("input",t.parentNode)[0]),d.datepicker._isDisabledDatepicker(t)||d.datepicker._lastInput===t||(o.cssFlag||((e=document.createElement("style")).innerHTML="."+o.selectors.today+"{display:none;}",document.body.appendChild(e),o.cssFlag=!0),e=d.datepicker._getInst(t),i=e.settings.range,d.datepicker._curInst&&d.datepicker._curInst!==e&&(d.datepicker._curInst.dpDiv.stop(!0,!0),e)&&d.datepicker._datepickerShowing&&d.datepicker._hideDatepicker(d.datepicker._curInst.input[0]),!1!==(a=(a=d.datepicker._get(e,"beforeShow"))?a.apply(t,[t,e]):{})&&(o.datepicker_extendRemove(e.settings,a),e.lastVal=null,d.datepicker._lastInput=t,d.datepicker._setDateFromField(e),d.datepicker._inDialog&&(t.value=""),d.datepicker._pos||(d.datepicker._pos=d.datepicker._findPos(t),d.datepicker._pos[1]+=t.offsetHeight),s=!1,d(t).parents().each(function(){return!(s|="fixed"===d(this).css("position"))}),a={left:d.datepicker._pos[0],top:d.datepicker._pos[1]},d.datepicker._pos=null,e.dpDiv.empty(),e.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),d.datepicker._updateDatepicker(e),a=d.datepicker._checkOffset(e,a,s),e.dpDiv.css({position:d.datepicker._inDialog&&d.blockUI?"static":s?"fixed":"absolute",display:"none",left:a.left+"px",top:a.top+"px",width:"auto"}),e.inline||(a=d.datepicker._get(e,"showAnim"),r=d.datepicker._get(e,"duration"),e.dpDiv.css("z-index",o.datepicker_getZindex(d(t))+1),d.datepicker._datepickerShowing=!0,d.effects&&d.effects.effect[a]?e.dpDiv.show(a,d.datepicker._get(e,"showOptions"),r):e.dpDiv[a||"show"](a?r:null),d.datepicker._shouldFocusInput(e)&&e.input.trigger("focus"),d.datepicker._curInst=e),n=d.datepicker._gotoToday,d.datepicker._gotoToday=function(e){n.call(this,e),this._selectDate(e),i||d(t).focus()},o.updateElements(e),o.setFocus(o.selectors.prev),e.dpDiv.off(),e.dpDiv.on("keydown",{widg:o,instance:e},o.datePickHandler)))},d.datepicker._selectDate=function(e,t){var e=d(e),e=this._getInst(e[0]),s=e.settings.range;onSelect=this._get(e,"onSelect"),t=null!=t?t:this._formatDate(e),this._updateAlternate(e),onSelect?onSelect.apply(e.input?e.input[0]:null,[t,e]):e.input&&e.input.trigger("change"),e.inline||s?(this._updateDatepicker(e),d("a."+o.selectors.activeDay,o.datepickerContainer).focus(),o.updateElements(e)):(e.input&&e.input.val(t),this._hideDatepicker(),this._lastInput=e.input[0],"object"!=typeof e.input[0]&&e.input.focus(),this._lastInput=null)}}})})(jQuery);